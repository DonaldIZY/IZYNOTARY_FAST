import{_ as X}from"./ClAYQHhI.js";import{a as ee,P as R,r as g,Q as ae,R as te,S as se,T as le,F as oe,U as F,W as re,L as v,I as ne,X as ie,i as ue,Y as N,Z as q,$ as de,o as ce,t as O,a0 as z,A as y,z as l,a1 as M,M as I,a2 as j,N as T,q as L,D as k,_ as me,v as fe,x,J as pe,B as $,y as ye,a3 as P}from"./DXnXjm7K.js";import{h as ve}from"./CW7irCmf.js";import{V as H,b as J,c as K}from"./B22xuEom.js";import{V as Y,a as U}from"./B8Rr4oru.js";import{V as Z,a as G}from"./BS0uIqYZ.js";import{V as Q}from"./CHercgjs.js";import{_ as _e}from"./D1tss4Vx.js";import{_ as he}from"./EBw08yYa.js";import{V as De}from"./Bip00q1m.js";import{V as ge}from"./CSLxKgvM.js";import"./Ctz4MgHs.js";const Ve=o=>o==="defer"||o===!1;function be(...o){var t;const u=typeof o[o.length-1]=="string"?o.pop():void 0;typeof o[0]!="string"&&o.unshift(u);let[s,c,a={}]=o;if(typeof s!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof c!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const e=ee(),r=c,h=()=>R.value,V=()=>e.isHydrating?e.payload.data[s]:e.static.data[s];a.server=a.server??!0,a.default=a.default??h,a.getCachedData=a.getCachedData??V,a.lazy=a.lazy??!1,a.immediate=a.immediate??!0,a.deep=a.deep??R.deep,a.dedupe=a.dedupe??"cancel";const b=a.getCachedData(s,e),w=b!=null;if(!e._asyncData[s]||!a.immediate){(t=e.payload._errors)[s]??(t[s]=R.errorValue);const f=a.deep?g:ae;e._asyncData[s]={data:f(w?b:a.default()),pending:g(!w),error:te(e.payload._errors,s),status:g("idle"),_default:a.default}}const i={...e._asyncData[s]};delete i._default,i.refresh=i.execute=(f={})=>{if(e._asyncDataPromises[s]){if(Ve(f.dedupe??a.dedupe))return e._asyncDataPromises[s];e._asyncDataPromises[s].cancelled=!0}if(f._initial||e.isHydrating&&f._initial!==!1){const m=f._initial?b:a.getCachedData(s,e);if(m!=null)return Promise.resolve(m)}i.pending.value=!0,i.status.value="pending";const _=new Promise((m,n)=>{try{m(r(e))}catch(D){n(D)}}).then(async m=>{if(_.cancelled)return e._asyncDataPromises[s];let n=m;a.transform&&(n=await a.transform(m)),a.pick&&(n=Ce(n,a.pick)),e.payload.data[s]=n,i.data.value=n,i.error.value=R.errorValue,i.status.value="success"}).catch(m=>{if(_.cancelled)return e._asyncDataPromises[s];i.error.value=re(m),i.data.value=v(a.default()),i.status.value="error"}).finally(()=>{_.cancelled||(i.pending.value=!1,delete e._asyncDataPromises[s])});return e._asyncDataPromises[s]=_,e._asyncDataPromises[s]},i.clear=()=>Ee(e,s);const E=()=>i.refresh({_initial:!0}),p=a.server!==!1&&e.payload.serverRendered;{const f=ne();if(f&&p&&a.immediate&&!f.sp&&(f.sp=[]),f&&!f._nuxtOnBeforeMountCbs){f._nuxtOnBeforeMountCbs=[];const n=f._nuxtOnBeforeMountCbs;se(()=>{n.forEach(D=>{D()}),n.splice(0,n.length)}),le(()=>n.splice(0,n.length))}p&&e.isHydrating&&(i.error.value||b!=null)?(i.pending.value=!1,i.status.value=i.error.value?"error":"success"):f&&(e.payload.serverRendered&&e.isHydrating||a.lazy)&&a.immediate?f._nuxtOnBeforeMountCbs.push(E):a.immediate&&E();const _=ie();if(a.watch){const n=oe(a.watch,()=>i.refresh());_&&F(n)}const m=e.hook("app:data:refresh",async n=>{(!n||n.includes(s))&&await i.refresh()});_&&F(m)}const d=Promise.resolve(e._asyncDataPromises[s]).then(()=>i);return Object.assign(d,i),d}function Ee(o,u){u in o.payload.data&&(o.payload.data[u]=void 0),u in o.payload._errors&&(o.payload._errors[u]=R.errorValue),o._asyncData[u]&&(o._asyncData[u].data.value=void 0,o._asyncData[u].error.value=R.errorValue,o._asyncData[u].pending.value=!1,o._asyncData[u].status.value="idle"),u in o._asyncDataPromises&&(o._asyncDataPromises[u]&&(o._asyncDataPromises[u].cancelled=!0),o._asyncDataPromises[u]=void 0)}function Ce(o,u){const s={};for(const c of u)s[c]=o[c];return s}function W(o,u,s){const[c={},a]=typeof u=="string"?[{},u]:[u,s],e=ue(()=>N(o)),r=c.key||ve([a,typeof e.value=="string"?e.value:"",...we(c)]);if(!r||typeof r!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+r);if(!o)throw new Error("[nuxt] [useFetch] request is missing.");const h=r===a?"$f"+r:r;if(!c.baseURL&&typeof e.value=="string"&&e.value[0]==="/"&&e.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:V,lazy:b,default:w,transform:i,pick:E,watch:p,immediate:d,getCachedData:t,deep:f,dedupe:_,...m}=c,n=q({...de,...m,cache:typeof c.cache=="boolean"?void 0:c.cache}),D={server:V,lazy:b,default:w,transform:i,pick:E,immediate:d,getCachedData:t,deep:f,dedupe:_,watch:p===!1?[]:[n,e,...p||[]]};let C;return be(h,()=>{var B;(B=C==null?void 0:C.abort)==null||B.call(C,new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),C=typeof AbortController<"u"?new AbortController:{};const S=N(c.timeout);let A;return S&&(A=setTimeout(()=>C.abort(new DOMException("Request aborted due to timeout.","AbortError")),S),C.signal.onabort=()=>clearTimeout(A)),(c.$fetch||globalThis.$fetch)(e.value,{signal:C.signal,...n}).finally(()=>{clearTimeout(A)})},D)}function we(o){var s;const u=[((s=N(o.method))==null?void 0:s.toUpperCase())||"GET",N(o.baseURL)];for(const c of[o.params||o.query]){const a=N(c);if(!a)continue;const e={};for(const[r,h]of Object.entries(a))e[N(r)]=N(h);u.push(e)}return u}const Ue={__name:"user",props:{open:{type:Boolean,default:!1}},emits:["update:open"],setup(o,{emit:u}){const s=o,c=g(""),a=g(""),e=g(""),r=g([]),h=g(null),V=u,b=L(),w=()=>{c.value="",a.value="",e.value="",h.value=null},i=()=>{w(),V("update:open",!1)},E=async()=>{const _={lastName:c.value,firstName:a.value,email:e.value,roleId:h.value};try{const m=await $fetch(`${b.public.baseUrl}/users`,{method:"POST",body:JSON.stringify(_)});alert("Utilisateur créé avec succès."),i()}catch(m){console.error("Erreur lors de la création de l'utilisateur :",m)}},p=_=>!!_||"Le champ est requis.",d=_=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(_)||"Veuillez entrer une adresse email valide.",{data:t,error:f}=W(`${b.public.baseUrl}/roles`,"$rq42d9012t");return ce(()=>{t.value?r.value=t.value.map(_=>({ID:_.id,NAME:_.name})):f.value&&console.error("Erreur lors du chargement des roles :",f.value)}),(_,m)=>(O(),z(Q,{modelValue:s.open,"onUpdate:modelValue":m[4]||(m[4]=n=>s.open=n),"max-width":"600"},{default:y(()=>[l(H,{"prepend-icon":"mdi-account-plus",title:"Créer un utilisateur"},{default:y(()=>[l(J,null,{default:y(()=>[l(Y,{dense:""},{default:y(()=>[l(U,{cols:"6"},{default:y(()=>[l(M,{modelValue:v(c),"onUpdate:modelValue":m[0]||(m[0]=n=>I(c)?c.value=n:null),color:"primary",label:"Nom",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(U,{cols:"6"},{default:y(()=>[l(M,{modelValue:v(a),"onUpdate:modelValue":m[1]||(m[1]=n=>I(a)?a.value=n:null),color:"primary",label:"Prénoms",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(U,{cols:"6"},{default:y(()=>[l(M,{modelValue:v(e),"onUpdate:modelValue":m[2]||(m[2]=n=>I(e)?e.value=n:null),color:"primary",label:"Email",variant:"outlined",rules:[p,d]},null,8,["modelValue","rules"])]),_:1}),l(U,{cols:"6"},{default:y(()=>[l(Z,{modelValue:v(h),"onUpdate:modelValue":m[3]||(m[3]=n=>I(h)?h.value=n:null),color:"primary",label:"Rôle",items:v(r),"item-title":"NAME","item-value":"ID",variant:"outlined"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),l(G),l(K,null,{default:y(()=>[l(j),l(T,{text:"Annuler",variant:"plain",onClick:i,class:"text-none"}),l(T,{color:"primary",text:"Enregistrer",variant:"tonal",onClick:E,class:"text-none"})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ne={__name:"user",props:{open:Boolean,userData:Object},emits:["update:open"],setup(o,{emit:u}){const s=o,c=u,a=L(),e=g([]),r=q({id:null,lastName:"",firstName:"",email:"",roleId:null});k(()=>{var p;s.userData&&(r.id=s.userData.ID,r.lastName=s.userData.LAST_NAME,r.firstName=s.userData.FIRST_NAME,r.email=s.userData.EMAIL,r.roleId=(p=s.userData.ROLE)==null?void 0:p.id)});const{data:h,error:V}=W(`${a.public.baseUrl}/roles`,"$ADP5ZjRhYE");k(()=>{h.value?e.value=h.value.map(p=>({ID:p.id,NAME:p.name})):V.value&&console.error("Erreur lors du chargement des rôles :",V.value)});const b=p=>!!p||"Le champ est requis.",w=p=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)||"Veuillez entrer une adresse email valide.",i=()=>{c("update:open",!1)},E=async()=>{try{if(!(await fetch(`${a.public.baseUrl}/users/${r.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw new Error("Erreur lors de la modification");alert("Utilisateur modifié avec succès."),c("userUpdated"),i()}catch(p){console.error("Erreur lors de la modification de l'utilisateur :",p)}};return(p,d)=>(O(),z(Q,{modelValue:p.$props.open,"onUpdate:modelValue":d[4]||(d[4]=t=>p.$props.open=t),"max-width":"600"},{default:y(()=>[l(H,{"prepend-icon":"mdi-account-edit",title:"Modifier un utilisateur"},{default:y(()=>[l(J,null,{default:y(()=>[l(Y,{dense:""},{default:y(()=>[l(U,{cols:"6"},{default:y(()=>[l(M,{modelValue:v(r).lastName,"onUpdate:modelValue":d[0]||(d[0]=t=>v(r).lastName=t),color:"primary",label:"Nom",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(U,{cols:"6"},{default:y(()=>[l(M,{modelValue:v(r).firstName,"onUpdate:modelValue":d[1]||(d[1]=t=>v(r).firstName=t),color:"primary",label:"Prénoms",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(U,{cols:"6"},{default:y(()=>[l(M,{modelValue:v(r).email,"onUpdate:modelValue":d[2]||(d[2]=t=>v(r).email=t),color:"primary",label:"Email",variant:"outlined",rules:[b,w]},null,8,["modelValue","rules"])]),_:1}),l(U,{cols:"6"},{default:y(()=>[l(Z,{modelValue:v(r).roleId,"onUpdate:modelValue":d[3]||(d[3]=t=>v(r).roleId=t),color:"primary",label:"Rôle",items:v(e),"item-title":"NAME","item-value":"ID",variant:"outlined"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),l(G),l(K,null,{default:y(()=>[l(j),l(T,{text:"Annuler",variant:"plain",onClick:i,class:"text-none"}),l(T,{color:"primary",text:"Enregistrer",variant:"tonal",onClick:E,class:"text-none"})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Re={class:"d-flex justify-space-between ma-4"},Me={class:"ma-4"},$e={class:"no-data-container"},Te={__name:"users",setup(o){const u=L(),s=g([{align:"start",key:"NUM",title:"N°"},{align:"start",key:"LAST_NAME",title:"Nom"},{align:"start",key:"FIRST_NAME",title:"Prénoms"},{align:"start",key:"EMAIL",title:"Email"},{align:"start",key:"CREATE_AT",title:"Date de création"},{align:"start",key:"ROLE",title:"Rôle"},{align:"start",key:"actions",title:"Actions"}]),c=g([]),a=g(null),e=g(!1),r=g(!1),h=g(!1),V=g(null),b=()=>{e.value=!e.value},w=d=>{V.value=d,r.value=!r.value},i=d=>{V.value=d,h.value=!h.value},E=async()=>{try{const d=await $fetch(`${u.public.baseUrl}/users`);d&&(c.value=d.map((t,f)=>({NUM:f+1,ID:t.id,LAST_NAME:t.lastName,FIRST_NAME:t.firstName,EMAIL:t.email,CREATE_AT:new Date(t.createAt).toLocaleDateString(),ROLE:t.role})))}catch(d){console.error("Erreur lors du chargement des utilisateurs :",d)}};E(),k(()=>{e.value||E()});const p=async d=>{try{await $fetch(`${u.public.baseUrl}/users/${d}`,{method:"DELETE"}),alert("Utilisateur supprimé avec succès!");const t=c.value.filter(f=>f.ID!==d);c.value=t,V.value=null}catch(t){console.error("Erreur lors de la suppression de l'utilisateur :",t)}};return(d,t)=>{const f=X,_=Ue,m=Ne,n=_e;return O(),fe(pe,null,[x("div",Re,[l(f,{title:"Liste des utilisateurs",goBackTo:"/home"}),l(T,{prependIcon:"mdi-account-plus-outline",color:"primary",class:"text-none",onClick:b},{default:y(()=>t[3]||(t[3]=[$("Ajouter un utilisateur")])),_:1}),l(_,{open:v(e),"onUpdate:open":t[0]||(t[0]=D=>e.value=D)},null,8,["open"])]),x("div",Me,[l(De,{headers:v(s),items:v(c),search:v(a),"items-per-page-text":"Utilisateurs par page :","page-text":"",class:"customTable1",density:"compact","fixed-header":"",hover:""},{"item.ROLE":y(({item:D})=>[$(ye(D.ROLE.name),1)]),"item.actions":y(({item:D})=>[l(P,{class:"me-2",size:"small",color:"primary",onClick:C=>i(D)},{default:y(()=>t[4]||(t[4]=[$(" mdi-pencil ")])),_:2},1032,["onClick"]),l(P,{class:"me-2",size:"small",color:"primary",onClick:C=>w(D)},{default:y(()=>t[5]||(t[5]=[$(" mdi-delete ")])),_:2},1032,["onClick"]),l(P,{size:"small",color:"primary",onClick:C=>d.changePassword(D)},{default:y(()=>t[6]||(t[6]=[$(" mdi-lock-reset ")])),_:2},1032,["onClick"])]),"no-data":y(()=>[x("div",$e,[l(ge,{src:he,height:"80",width:"80",class:"mb-3",alt:"Aucune donnée"}),t[7]||(t[7]=x("p",null,"Aucune donnée",-1))])]),_:1},8,["headers","items","search"]),l(m,{open:v(h),userData:v(V),"onUpdate:open":t[1]||(t[1]=D=>h.value=D),onUserUpdated:E},null,8,["open","userData"]),l(n,{text:"Vous allez supprimer un utilisateur. Continuer?",open:v(r),"onUpdate:open":t[2]||(t[2]=D=>r.value=D),submit:()=>p(v(V).ID)},null,8,["open","submit"])])],64)}}},Je=me(Te,[["__scopeId","data-v-e3e4e008"]]);export{Je as default};
